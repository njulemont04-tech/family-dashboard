{% extends 'base.html' %} {% block title %}{{ _('Bulletin Board') }}{% endblock
%} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="mb-0">{{ _('Bulletin Board') }}</h1>
</div>

<div class="row">
  <div class="col-md-8">
    <!-- START: NEW PINNED NOTES SECTION -->
    <div
      class="pinned-notes-section mb-5"
      id="pinned-notes-section"
      {%
      if
      not
      pinned_notes
      %}style="display: none;"
      {%
      endif
      %}
    >
      <h4 class="mb-3">
        <i class="bi bi-pin-angle-fill me-2"></i>{{ _('Pinned Notes') }}
      </h4>
      <div id="pinned-notes-list">
        {% if pinned_notes %} {% for note in pinned_notes %}
        <div
          class="card mb-3 border-primary"
          id="note-{{ note.id }}"
          data-timestamp="{{ note.timestamp.isoformat() }}"
        >
          <!-- Card content remains exactly the same -->
          <div class="card-body d-flex justify-content-between">
            <div>
              <p class="card-text fs-5">{{ note.content }}</p>
              <p class="card-subtitle text-muted" style="font-size: 0.8rem">
                {{ _('Posted by') }}
                <strong>{{ note.author.username }}</strong> {{ _('on') }} {{
                note.timestamp.strftime('%b %d, %Y at %I:%M %p') }}
                <span class="badge bg-primary ms-2">{{ _('Pinned') }}</span>
              </p>
            </div>
            <div class="d-flex align-items-start">
              <form
                action="{{ url_for('pin_note') }}"
                method="POST"
                class="note-pin-form me-2"
                data-note-id="{{ note.id }}"
              >
                <input type="hidden" name="note_id" value="{{ note.id }}" />
                <button
                  type="submit"
                  class="btn btn-sm btn-outline-primary"
                  title="{{ _('Unpin Note') }}"
                >
                  <i class="bi bi-pin-angle-fill"></i>
                </button>
              </form>
              {% if note.author_id == current_user.id %}
              <form
                action="{{ url_for('delete_note') }}"
                method="POST"
                class="note-delete-form confirm-delete"
                data-note-id="{{ note.id }}"
              >
                <input type="hidden" name="note_id" value="{{ note.id }}" />
                <button
                  type="submit"
                  class="btn-close"
                  aria-label="{{ _('Delete') }}"
                ></button>
              </form>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %} {% endif %}
      </div>
      <hr />
    </div>
    <!-- END: NEW PINNED NOTES SECTION -->

    <div id="notes-list">
      {% for note in current_family.notes|sort(attribute='timestamp',
      reverse=true) %} {% if not note.is_pinned %}
      <div
        class="card mb-3"
        id="note-{{ note.id }}"
        data-timestamp="{{ note.timestamp.isoformat() }}"
      >
        <div class="card-body d-flex justify-content-between">
          <div>
            <p class="card-text fs-5">{{ note.content }}</p>
            <p class="card-subtitle text-muted" style="font-size: 0.8rem">
              {{ _('Posted by') }}
              <strong>{{ note.author.username }}</strong> {{ _('on') }} {{
              note.timestamp.strftime('%b %d, %Y at %I:%M %p') }}
            </p>
          </div>
          <div class="d-flex align-items-start">
            <!-- Flex container for buttons -->
            <form
              action="{{ url_for('pin_note') }}"
              method="POST"
              class="note-pin-form me-2"
              data-note-id="{{ note.id }}"
            >
              <input type="hidden" name="note_id" value="{{ note.id }}" />
              <button
                type="submit"
                class="btn btn-sm btn-outline-primary"
                title="{{ _('Pin Note') }}"
              >
                <i class="bi bi-pin-angle-fill"></i>
              </button>
            </form>

            {% if note.author_id == current_user.id %}
            <form
              action="{{ url_for('delete_note') }}"
              method="POST"
              class="note-delete-form confirm-delete"
              data-note-id="{{ note.id }}"
            >
              <input type="hidden" name="note_id" value="{{ note.id }}" />
              <button
                type="submit"
                class="btn-close"
                aria-label="{{ _('Delete') }}"
              ></button>
            </form>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %} {% endfor %}
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">{{ _('Add a New Note') }}</h5>
        <form
          action="{{ url_for('add_note') }}"
          method="POST"
          class="note-add-form"
        >
          <div class="mb-3">
            <textarea
              name="content"
              class="form-control"
              rows="4"
              placeholder="{{ _('Type your note here...') }}"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-success w-100">
            {{ _('Post Note') }}
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
