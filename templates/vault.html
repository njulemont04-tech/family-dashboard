{% extends 'base.html' %} {# 1. Import our reusable macro file #} {% from
'_macros.html' import feature_header %} {% block title %}{{ _('Family Vault')
}}{% endblock %} {% block content %} {# 2. Call the feature_header macro. The
"Add New Entry" button goes inside the 'call' block. #} {% call
feature_header(_('Family Vault'), show_actions_on_mobile=False) %} {% if
current_user.id == current_family.owner_id %}
<button
  class="btn btn-primary"
  data-bs-toggle="modal"
  data-bs-target="#addEntryModal"
>
  <i class="bi bi-plus-lg me-1"></i> <span>{{ _('Add New Entry') }}</span>
</button>
{% endif %} {% endcall %} {# 3. Old title div is gone. Flash messages are
preserved. #} {% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %} {% for category, message in messages %}
<div
  class="alert alert-{{ category }} alert-dismissible fade show"
  role="alert"
>
  {{ message }}
  <button
    type="button"
    class="btn-close"
    data-bs-dismiss="alert"
    aria-label="{{ _('Close') }}"
  ></button>
</div>
{% endfor %} {% endif %} {% endwith %} {% if not entries_by_category %}
<div class="card" id="empty-vault-card">
  <div class="card-body text-center">
    <h5 class="card-title">{{ _('The Vault is Empty') }}</h5>
    <p class="card-text">
      {{ _('The family admin can add important household information here.') }}
    </p>
  </div>
</div>
{% endif %}

<div class="accordion" id="vaultAccordion">
  {% for category, entries in entries_by_category.items() %}
  <div class="accordion-item">
    <h2
      class="accordion-header"
      id="heading-{{ category.replace(' ', '-').lower() }}"
    >
      <button
        class="accordion-button {% if not loop.first %}collapsed{% endif %}"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#collapse-{{ category.replace(' ', '-').lower() }}"
        aria-expanded="{% if loop.first %}true{% else %}false{% endif %}"
        aria-controls="collapse-{{ category.replace(' ', '-').lower() }}"
      >
        {{ category }}
      </button>
    </h2>
    <div
      id="collapse-{{ category.replace(' ', '-').lower() }}"
      class="accordion-collapse collapse {% if loop.first %}show{% endif %}"
      aria-labelledby="heading-{{ category.replace(' ', '-').lower() }}"
      data-bs-parent="#vaultAccordion"
    >
      <div
        class="list-group list-group-flush"
        id="category-{{ category.replace(' ', '-').lower() }}"
      >
        {% for entry in entries %} {% include '_vault_entry.html' %} {% endfor
        %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- 4. Add the new Floating Action Button for mobile (Admin only) -->
{% if current_user.id == current_family.owner_id %}
<a
  href="#"
  class="btn btn-primary rounded-circle fab d-md-none"
  data-bs-toggle="modal"
  data-bs-target="#addEntryModal"
  title="{{ _('Add New Entry') }}"
>
  <i class="bi bi-plus-lg"></i>
</a>
{% endif %}

<!-- This container is for modals -->
<div id="modal-container">
  {% if entries_by_category %} {% for category, entries in
  entries_by_category.items() %} {% for entry in entries %} {% include
  '_edit_vault_modal.html' %} {% endfor %} {% endfor %} {% endif %}
</div>

<!-- Add Entry Modal (Unchanged) -->
{% if current_user.id == current_family.owner_id %}
<div
  class="modal fade"
  id="addEntryModal"
  tabindex="-1"
  aria-labelledby="addEntryModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form action="{{ url_for('add_vault_entry') }}" method="POST">
        <div class="modal-header">
          <h5 class="modal-title" id="addEntryModalLabel">
            {{ _('Add New Vault Entry') }}
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="{{ _('Close') }}"
          ></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="add-category" class="form-label"
              >{{ _('Category') }}</label
            >
            <input
              type="text"
              class="form-control"
              id="add-category"
              name="category"
              list="category-suggestions"
              placeholder="{{ _('e.g., Emergency Contacts') }}"
              required
            />
            <datalist id="category-suggestions">
              {% for cat in categories %}
              <option value="{{ cat }}"></option>
              {% endfor %}
            </datalist>
          </div>
          <div class="mb-3">
            <label for="add-title" class="form-label">{{ _('Title') }}</label>
            <input
              type="text"
              class="form-control"
              id="add-title"
              name="title"
              placeholder="{{ _('e.g., Guest Wi-Fi') }}"
              required
            />
          </div>
          <div class="mb-3">
            <label for="add-content" class="form-label"
              >{{ _('Content') }}</label
            >
            <textarea
              class="form-control"
              id="add-content"
              name="content"
              rows="5"
              required
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            {{ _('Cancel') }}
          </button>
          <button type="submit" class="btn btn-primary">
            {{ _('Save Entry') }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %} {% endblock %}
